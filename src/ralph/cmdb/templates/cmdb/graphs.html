{%extends 'cmdb/base.html'%}

{% load bob %}
{% load icons %}

{% block scripts %}
    {{ block.super }}
    <script type="text/javascript" src="{{STATIC_URL}}cmdb/VivaGraphJS/vivagraph.js"></script>
    <script type="text/javascript" src="{{STATIC_URL}}cmdb/zoom.js"></script>
    <script type="text/javascript">
    
function draw_graph(data) {
    var graph = Viva.Graph.graph();
    for (var i=0; i<data.nodes.length; i++)
    {
        graph.addNode(data.nodes[i][0], data.nodes[i][1]);
    }
    for (var i=0; i<data.relations.length; i++)
    {
        graph.addLink(data.relations[i].parent, data.relations[i].child);
    }
    var graphics = Viva.Graph.View.svgGraphics();
    graphics.node(function(node) {
            e = Viva.Graph.svg('text')
            .attr('width', 224)
            .attr('height', 180);
            e.textContent = node.data;
            return e
            })
    .placeNode(function(nodeUI, pos){
            nodeUI.attr('x', pos.x).attr('y', pos.y);
            });
    var renderer = Viva.Graph.View.renderer(graph, {
graphics : graphics
});
renderer.run();
}
</script>

<script type="text/javascript" charset="utf-8">
    $(document).ready(function()
    {
      {{ graph_data }}
    });
</script>

{% endblock %}

{% block contentarea %}
    {{ block.super }}

    {% form_horizontal form=form method="get" action="/cmdb/graphs" title='Formularz' %}
    <hr>
    <table class="table table-striped table-condensed table-list table-bordered">
        <tbody>
        <tr>
            <th> Name </th>
            <th> UID </th>
        </tr>
        {% for row in rows %}
        <tr><td> {{ row.name }} </td> <td> {{ row.uid }} </td></tr>
        {% endfor %}
    </tbody>
    </table>
    <h4> Impact graph </h4>
    <div id='container' style='width:800; height:800;border: solid #ddd 1px'>
        <div id='chart' style='position: absolute; top: 0px; margin-top:300px' width='800' height='800'>
        </div>
    </div>
{% endblock %}
